<!DOCTYPE html><html lang=en><meta charset=utf-8><title>Music Maker</title><style>*{box-sizing:border-box}body{padding:0;margin:0;background-color:#263238;padding-top:150px}#header{position:fixed;top:0;width:100%;background-color:#FAFAFA;color:#263238;font-size:30px;font-weight:600;font-family:sans-serif;text-transform:uppercase;text-align:center;padding:25px;cursor:pointer}#header:hover{color:#F44336}._track_{margin:0 auto}._track_ button{background-color:#263238;padding:10px;border:10px solid #F5F5F5;border-radius:2px;margin:5px;cursor:pointer;outline:0}._track_ button.on{background-color:#F44336;border-color:#F44336}._track_ button.ticked{background-color:#F5F5F5;border-color:#F5F5F5}._track_ span{display:block;float:left;width:240px;text-align:center;font-family:sans-serif;font-weight:600;font-size:14px;text-transform:uppercase;color:#FAFAFA;padding:8px;margin-top:4px;margin-right:10px;border-radius:2px;border:5px solid #FAFAFA;cursor:pointer;text-overflow:hidden}._track_ span:hover{border-color:#F44336;background-color:#F44336}._track_ i{display:block;float:right;color:#FAFAFA;background-color:#263238;border-radius:50%;border:5px solid #FAFAFA;padding:5px 9px;margin-left:8px;margin-top:5px;font-style:normal;font-weight:600;cursor:pointer}._track_ i:hover{border-color:#F44336;background-color:#F44336}#controls{position:fixed;bottom:0;width:100%;background-color:#FAFAFA}#_controls_ div{text-align:center;padding-bottom:20px}#_controls_ input,#_controls_ span{display:inline-block;width:130px;cursor:pointer;font-family:sans-serif;font-weight:600;text-transform:uppercase;text-align:center;color:#263238;font-size:14px;padding:5px 10px;border:5px solid #263238;border-radius:2px;margin:20px 5px 0 5px}#_controls_ input:hover,#_controls_ span:hover{color:#FAFAFA;background-color:#263238}#_controls_ input{outline:0}#_sound-selector_{display:none;position:absolute;width:100%;background-color:#37474F;color:#FAFAFA;top:0;padding:30px;transition:opacity .5s}#_sound-selector_ span{position:absolute;top:50px;right:50px;cursor:pointer;font-size:25px}#_sound-selector_>p{font-size:25px;font-weight:600;padding:20px;padding-top:60px;color:#FAFAFA;font-family:sans-serif;text-transform:uppercase;border-bottom:5px solid #FAFAFA;clear:both}#_sound-selector_ div p{font-weight:600;font-family:sans-serif;width:180px;float:left;text-align:center;text-transform:uppercase;padding:15px;margin:15px;border-radius:2px;border:4px solid #FAFAFA;cursor:pointer}#_sound-selector_ div p:hover{background-color:#FAFAFA;color:#37474F}#_sound-selector_.visible{display:block}noscript{display:block;font-size:25px;font-family:sans-serif;font-weight:600;color:#FAFAFA;text-align:center}</style><div id=header>Music Maker</div><div id=grid></div><div id=controls></div><div id=sound-selector></div><noscript>Sorry, Javascript is not supported by this browser.</noscript><script>function musicMaker(){this.BPM,this.TICKS,this.INTERVAL,this.tracks=[],this.sounds=[],this.STATE="CREATED",this.audioCtx,this.grid,this.controls,this.soundSelector}musicMaker.prototype.init=function(t,e,n){var i=this,s=new XMLHttpRequest;s.open("GET","sound_data.json",!0),s.responseType="json",s.onload=function(){i.BPM=s.response.default_BPM,i.TICKS=s.response.default_ticks,i.INTERVAL=i.getInterval(),i.tracks=s.response.default_tracks,i.sounds=s.response.sounds;try{i.audioCtx=new(window.AudioContext||window.webkitAudioContext)}catch(t){alert("Sorry, Web Audio API is not supported by this browser.")}var r=document.createElement("div");r.setAttribute("id","_sound-selector_");var o=document.createElement("span");o.innerHTML="&#x2716;",o.addEventListener("click",function(){i.soundSelector.classList.remove("visible")},!1),r.appendChild(o);for(var a=0;a<i.sounds.length;a++){var c=document.createElement("p");c.innerHTML=i.sounds[a].group;for(var u=document.createElement("div"),d=0;d<i.sounds[a].files.length;d++){var l=document.createElement("p");l.innerHTML=i.sounds[a].files[d].name,l.setAttribute("group",i.sounds[a].group),l.setAttribute("name",i.sounds[a].files[d].name),l.setAttribute("url",i.sounds[a].files[d].url),l.className="_sound_",u.appendChild(l)}r.appendChild(c),r.appendChild(u)}document.getElementById(n).innerHTML="",document.getElementById(n).appendChild(r),i.soundSelector=document.getElementById("_sound-selector_"),i.STATE="INITIALIZED",i.render(t,e)},s.send()},musicMaker.prototype.render=function(t,e){var n=this;this.grid=document.getElementById(t),this.grid.innerHTML="";for(var i=document.createElement("div"),s=0;s<this.tracks.length;s++){!function(t){var e=new XMLHttpRequest;e.open("GET",n.tracks[t].url,!0),e.responseType="arraybuffer",e.onload=function(){n.audioCtx.decodeAudioData(e.response,function(e){n.tracks[t].buffer=e})},e.send()}(s);var r=document.createElement("div");r.setAttribute("class","_track_");var o=document.createElement("span");o.id="track"+s,o.innerHTML=this.tracks[s].group+" ("+this.tracks[s].name+")",function(t){o.addEventListener("click",function(){n.initSoundSelection(t)},!1)}(s),r.appendChild(o);for(var a=0;a<this.TICKS;++a){var c=document.createElement("button");c.className="beat",c.addEventListener("click",function(){this.classList.toggle("on")},!1),a%4==0&&0!=a&&(c.style.marginLeft="15px"),r.appendChild(c)}r.style.width=50*this.TICKS+10*(Math.ceil(this.TICKS/4)-1)+250+50+"px";var u=document.createElement("i");u.innerHTML="&#x2716;",function(t){u.addEventListener("click",function(){n.removeTrack(t)},!1)}(s),r.appendChild(u),i.appendChild(r)}this.grid.appendChild(i),this.controls=document.getElementById(e),this.controls.innerHTML="";var d=document.createElement("div");d.setAttribute("id","_controls_");var l=document.createElement("div"),p=document.createElement("input");p.setAttribute("type","text"),p.setAttribute("value","BPM"),p.addEventListener("click",function(){this.value=n.BPM}),p.addEventListener("blur",function(){n.updateBPM(this.value),this.value="BPM"}),l.appendChild(p);var h=document.createElement("span");h.innerHTML="ADD TRACK",h.addEventListener("click",function(){n.initSoundSelection(-1)}),l.appendChild(h);var m=document.createElement("span");m.innerHTML="PLAY",m.setAttribute("id","_play_"),m.addEventListener("click",function(){"PLAY"==this.innerHTML?n.play():n.pause()}),l.appendChild(m);var T=document.createElement("span");T.innerHTML="STOP",T.addEventListener("click",function(){n.stop()}),l.appendChild(T);var E=document.createElement("input");E.setAttribute("type","text"),E.setAttribute("value","TICKS"),E.addEventListener("click",function(){this.value=n.TICKS}),E.addEventListener("blur",function(){n.updateTicks(this.value),this.value="TICKS"}),l.appendChild(E),d.appendChild(l),this.controls.appendChild(d),this.grid.style.marginBottom=this.controls.offsetHeight+60+"px",this.STATE="RENDERED"},musicMaker.prototype.play=function(){if("PLAYING"!=this.STATE)var t=this,e=setInterval(function(){requestAnimationFrame(function(){"RENDERED"==t.STATE||"STOPPED"==t.STATE?(t.STATE="PLAYING",t.drumLoop(0,t.TICKS-1,(new Date).getTime()),clearInterval(e),document.getElementById("_play_").innerHTML="PAUSE"):"PAUSED"==t.STATE&&(t.STATE="PLAYING",clearInterval(e),document.getElementById("_play_").innerHTML="PAUSE")})},250)},musicMaker.prototype.pause=function(){"PLAYING"==this.STATE&&(this.STATE="PAUSED",document.getElementById("_play_").innerHTML="PLAY")},musicMaker.prototype.stop=function(){if("PLAYING"==this.STATE||"PAUSED"==this.STATE){this.STATE="STOPPED",document.getElementById("_play_").innerHTML="PLAY";for(var t=document.getElementsByClassName("beat"),e=0;e<t.length;e++)t[e].classList.remove("ticked")}},musicMaker.prototype.refresh=function(){this.stop(),this.render(this.grid.id,this.controls.id),this.play()},musicMaker.prototype.drumLoop=function(t,e,n){var i=this;if("PLAYING"==this.STATE){var s=(new Date).getTime(),r=document.getElementsByClassName("beat");if(s-n>=this.INTERVAL){for(var o=0;o<this.tracks.length;o++){var a=r[o*this.TICKS+e],c=r[o*this.TICKS+t];if(a.classList.remove("ticked"),c.classList.add("ticked"),c.classList.contains("on")){var u=this.audioCtx.createBufferSource();u.buffer=this.tracks[o].buffer,u.connect(this.audioCtx.destination),u.start()}}e=t,t=(t+1)%this.TICKS,n=s}}"PLAYING"!=this.STATE&&"PAUSED"!=this.STATE||requestAnimationFrame(function(){i.drumLoop(t,e,n)})},musicMaker.prototype.getInterval=function(){return 1/(4*this.BPM/6e4)},musicMaker.prototype.updateBPM=function(t){t<=50?t=50:t>=500&&(t=500),this.BPM=t,this.INTERVAL=this.getInterval()},musicMaker.prototype.updateTicks=function(t){t<=4?t=4:t>=104&&(t=104),this.TICKS=t,this.refresh()},musicMaker.prototype.initSoundSelection=function(t){for(var e=this,n=document.getElementsByClassName("_sound_"),i=0;i<n.length;i++)t==-1?n[i].onclick=function(){e.addTrack(this.getAttribute("group"),this.getAttribute("name"),this.getAttribute("url")),e.soundSelector.classList.remove("visible")}:n[i].onclick=function(){e.updateTrack(t,this.getAttribute("group"),this.getAttribute("name"),this.getAttribute("url")),e.soundSelector.classList.remove("visible")};this.soundSelector.classList.add("visible")},musicMaker.prototype.addTrack=function(t,e,n){var i={group:t,name:e,url:n};this.tracks.push(i),this.refresh()},musicMaker.prototype.removeTrack=function(t){this.tracks.splice(t,1),this.refresh()},musicMaker.prototype.updateTrack=function(t,e,n,i){var s={group:e,name:n,url:i};this.tracks.splice(t,1,s),this.refresh()};var musicMakerInstance=new musicMaker;musicMakerInstance.init("grid","controls","sound-selector"),musicMakerInstance.play()</script>